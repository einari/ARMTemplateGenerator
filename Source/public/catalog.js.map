{"version":3,"sources":["Catalog.js"],"names":[],"mappings":"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","file":"Catalog.js","sourcesContent":["import $ from \"jquery\";\nimport ko from \"knockout\";\n\n\nconst _items = new WeakMap();\n\nconst _itemsByCategories = new WeakMap();\nconst _itemsByPublishers = new WeakMap();\n\nconst _categories = new WeakMap();\nconst _publishers = new WeakMap();\n\nconst _productNameIndex = new WeakMap();\n\nfunction hasCategories(item, categories) {\n    var found = false;\n    item.categoryIds.some((categoryId) => {\n        found |= categories.some((category) => categoryId == category);\n    });\n    return found;\n}\n\nko.bindingHandlers.popover = {\n    init: () => {\n        \n    },\n    \n    update: (element, valueAccessor) => {\n        $(element).popover({\n            html: true,\n            title: \"Description\",\n            placement: \"auto\",\n            content: ko.unwrap(valueAccessor())\n        });\n        \n    }\n};\n\n\n\nexport class Catalog {\n    constructor() {\n        var self = this;\n        \n        _itemsByCategories.set(this, {});\n        _categories.set(this, ko.observableArray());\n        _publishers.set(this, ko.observableArray());\n        _items.set(this, ko.observableArray());\n\n        this.isBusy = ko.observable(true);\n        $.getJSON(\"/catalog\", (data) => {\n            self.organizeByCategories(data);\n            self.isBusy(false);\n        });\n        \n        \n    }\n\n    get categories() {\n        return _categories.get(this);\n    }\n\n    get publishers() {\n        return _publishers.get(this);\n    }\n    \n    get items() {\n        return _items.get(this);\n    }\n\n    organizeByCategories(data) {\n        var itemsByCategories = {};\n        var itemsByPublishers = {};\n        \n        var categories = [\n            \"virtualMachine-Arm\",\n        ];\n        \n        var categoriesToSkip = [\n            \"Hidden_Byol\",\n            \"Hidden_FreeTrial\",\n            \"fromDataMarket\"\n        ];\n                \n        var items = _items.get(this);\n        \n        data.forEach((item) => {\n            if (!hasCategories(item, categories) ) {\n                return;\n            }\n            \n            if( hasCategories(item, categoriesToSkip)) {\n                return;\n            }\n\n            items.push(item);\n\n            var publisher = [];\n            if (itemsByPublishers.hasOwnProperty(item.publisher)) {\n                publisher = itemsByPublishers[item.publisher];\n            } else {\n                itemsByPublishers[item.publisher] = publisher;\n            }\n            publisher.push(item);\n\n            item.categoryIds.forEach((categoryId) => {\n                var category = [];\n                if (itemsByCategories.hasOwnProperty(categoryId)) {\n                    category = itemsByCategories[categoryId];\n                } else {\n                    itemsByCategories[categoryId] = category;\n                }\n\n                category.push(item);\n            });\n        });\n        \n        console.log(\"Items : \"+items().length+\" of \"+data.length+\" in total\");\n\n        _itemsByCategories.set(this, itemsByCategories);\n\n        this.prepareCategories(itemsByCategories);\n        this.preparePublishers(itemsByPublishers);\n    }\n\n    prepareCategories(itemsByCategories) {\n        var categories = this.categories;\n        for (let property in itemsByCategories) {\n            categories.push(property);\n        }\n        _categories.set(this, categories);\n    }\n\n    preparePublishers(itemsByPublishers) {\n        var publishers = this.publishers;\n        for (let property in itemsByPublishers) {\n            publishers.push(property);\n        }\n        _publishers.set(this, publishers);\n    }\n}"],"sourceRoot":"../Source"}