{"version":3,"sources":["Catalog.server.js"],"names":[],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;;;IAEa,O,WAAA,O;;;;;;;iCAYA;AACL,gBAAI,UAAU,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AAC3C,oBAAI,eAAe,EAAnB;;AAEA,oBAAI,aAAG,UAAH,CAAc,gBAAd,CAAJ,EAAqC;AACjC,4BAAQ,GAAR,CAAY,oBAAZ;;AAEA,iCAAG,QAAH,CAAY,gBAAZ,EAA8B,UAAC,KAAD,EAAQ,IAAR,EAAiB;AAC3C,gCAAQ,GAAR,CAAY,WAAZ;AACA,4BAAI,OAAO,KAAK,KAAL,CAAW,IAAX,CAAX;AACA,gCAAQ,IAAR;AACH,qBAJD;AAKH,iBARD,MAQO;;;;AAIH,wBAAI,UAAU;AACV,kCAAU,mBADA;AAEV,8BAAM,GAFI;AAGV,8BAAM,aAHI;AAIV,gCAAQ,KAJE;;AAMV,iCAAS;AACL,+CAAmB;AADd;AANC,qBAAd;;AAWA,wBAAI,WAAW,SAAX,QAAW,CAAC,QAAD,EAAc;AACzB,gCAAQ,GAAR,CAAY,UAAZ;AACA,gCAAQ,GAAR,CAAY,oBAAoB,SAAS,UAAzC;AACA,gCAAQ,GAAR,CAAY,iBAAiB,SAAS,OAAtC;;AAEA,iCAAS,EAAT,CAAY,MAAZ,EAAoB,UAAU,IAAV,EAAgB;AAChC,2CAAe,eAAe,KAAK,QAAL,EAA9B;AACH,yBAFD;;AAIA,iCAAS,EAAT,CAAY,OAAZ,EAAqB,UAAU,KAAV,EAAiB;AAClC,oCAAQ,KAAR,CAAc,KAAd;AACH,yBAFD;;AAIA,iCAAS,EAAT,CAAY,KAAZ,EAAmB,YAAY;AAC3B,oCAAQ,GAAR,CAAY,MAAZ;AACA,gCAAI,OAAO,KAAK,KAAL,CAAW,YAAX,CAAX;AACA,oCAAQ,IAAR;AACA,oCAAQ,GAAR,CAAY,QAAZ;;;AAKH,yBATD;AAUH,qBAvBD;;AAyBA,oCAAM,OAAN,CAAc,OAAd,EAAuB,QAAvB,EAAiC,GAAjC;AACH;AACJ,aArDa,CAAd;;AAuDA,mBAAO,OAAP;AACH;;;mCAnEiB,W,EAAa;AAC3B,wBAAY,GAAZ,CAAgB,UAAhB,EAA4B,UAAC,OAAD,EAAU,QAAV,EAAuB;AAC/C,oBAAI,UAAU,IAAI,OAAJ,EAAd;;AAEA,wBAAQ,MAAR,GAAiB,IAAjB,CAAsB,UAAC,IAAD,EAAU;AAC5B,6BAAS,IAAT,CAAc,IAAd;AACH,iBAFD;AAGH,aAND;AAOH","file":"Catalog.server.js","sourcesContent":["import https from \"https\";\nimport fs from \"fs\";\n\nexport class Catalog {\n\n    static initialize(application) {\n        application.get(\"/catalog\", (request, response) => {\n            var catalog = new Catalog();\n\n            catalog.getAll().then((data) => {\n                response.json(data);\n            });\n        });\n    }\n\n    getAll() {\n        var promise = new Promise((fulfill, reject) => {\n            var jsonAsString = \"\";\n\n            if (fs.existsSync(\"./catalog.json\")) {\n                console.log(\"File exists - read\");\n                \n                fs.readFile(\"./catalog.json\", (error, data) => {\n                    console.log(\"File read\");\n                    var json = JSON.parse(data);\n                    fulfill(json);\n                });\n            } else {\n\n                // /Microsoft.Gallery/GalleryItems?Subscriptions%255B0%255D=184d24f6-4143-47d2-a613-b3571f50ffd6&curationArea=create&limitRows=true&api-version=2015-04-01&combineReferences=true&curationId\n\n                var options = {\n                    hostname: \"gallery.azure.com\",\n                    port: 443,\n                    path: \"/api/invoke\",\n                    method: \"GET\",\n\n                    headers: {\n                        \"x-ms-path-query\": \"/Microsoft.Gallery/GalleryItems?api-version=2015-04-01\"\n                    }\n                };\n\n                var callback = (response) => {\n                    console.log(\"API Call\");\n                    console.log(\"  StatusCode : \" + response.statusCode);\n                    console.log(\"  Headers : \" + response.headers);\n\n                    response.on(\"data\", function (data) {\n                        jsonAsString = jsonAsString + data.toString();\n                    });\n\n                    response.on(\"error\", function (error) {\n                        console.error(error);\n                    });\n\n                    response.on(\"end\", function () {\n                        console.log(\"Done\");\n                        var json = JSON.parse(jsonAsString);\n                        fulfill(json);\n                        console.log(\"Parsed\");\n\n                        //fs.writeFile(\"./catalog.json\", jsonAsString);\n\n\n                    });\n                };\n\n                https.request(options, callback).end();\n            }\n        });\n\n        return promise;\n    }\n}\n\n\n"],"sourceRoot":"/source/"}